{"version":3,"sources":["../src/server.ts"],"sourcesContent":["import express from 'express';\nimport { createProxyMiddleware } from 'http-proxy-middleware';\nimport dotenv from 'dotenv';\nimport http from 'http';\n\ndotenv.config();\n\nconst app = express();\nconst PORT = process.env.GATEWAY_PORT ? parseInt(process.env.GATEWAY_PORT, 10) : 8080;\n\nconsole.log(`[Gateway] Attempting to start on PORT: ${PORT}`);\n\n// Definiera portar för olika spel\nconst GAME_PORTS: Record<string, number> = {\n  proviva: process.env.PROVIVA_PORT ? parseInt(process.env.PROVIVA_PORT, 10) : 3001,\n  doritos: process.env.DORITOS_PORT ? parseInt(process.env.DORITOS_PORT, 10) : 3002\n};\n\nconsole.log('[Gateway] Game Ports:', GAME_PORTS);\n\n// Middleware för loggning\napp.use((req, res, next) => {\n  console.log(`[Gateway] Incoming request: ${req.method} ${req.url}`);\n  next();\n});\n\n// Proxy middleware för varje spel\nObject.entries(GAME_PORTS).forEach(([game, port]) => {\n  console.log(`[Gateway] Setting up proxy for /${game} to localhost:${port}`);\n  app.use(`/${game}`, createProxyMiddleware({ \n    target: `http://localhost:${port}`,\n    changeOrigin: true,\n    pathRewrite: {\n      [`^/${game}`]: '/' // Ta bort /proviva prefix\n    },\n    onError: (err, req, res) => {\n      console.error(`[Gateway] Proxy error for /${game}:`, err);\n      res.status(500).send('Proxy error');\n    }\n  }));\n});\n\n// Landningssida\napp.get('/', (req, res) => {\n  res.send(`\n    <html>\n      <head>\n        <title>Rabble Games Gateway</title>\n        <style>\n          body { font-family: Arial, sans-serif; text-align: center; padding-top: 50px; }\n          h1 { color: #333; }\n          .games { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }\n          .game-link { \n            text-decoration: none; \n            padding: 10px 20px; \n            background-color: #4CAF50; \n            color: white; \n            border-radius: 5px; \n          }\n        </style>\n      </head>\n      <body>\n        <h1>Rabble Games Gateway</h1>\n        <div class=\"games\">\n          ${Object.keys(GAME_PORTS).map(game => \n            `<a href=\"/${game}\" class=\"game-link\">${game.charAt(0).toUpperCase() + game.slice(1)}</a>`\n          ).join('')}\n        </div>\n      </body>\n    </html>\n  `);\n});\n\n// Skapa HTTP-server\nconst server = http.createServer(app);\n\nserver.listen(PORT, '0.0.0.0', () => {\n  console.log(`[Gateway] Server SUCCESSFULLY running on http://localhost:${PORT}`);\n  Object.entries(GAME_PORTS).forEach(([game, port]) => {\n    console.log(`[Gateway] ${game.toUpperCase()} accessible at http://localhost:${PORT}/${game}`);\n  });\n});\n\nexport default server;\n"],"mappings":";AAAA,OAAO,aAAa;AACpB,SAAS,6BAA6B;AACtC,OAAO,YAAY;AACnB,OAAO,UAAU;AAEjB,OAAO,OAAO;AAEd,IAAM,MAAM,QAAQ;AACpB,IAAM,OAAO,QAAQ,IAAI,eAAe,SAAS,QAAQ,IAAI,cAAc,EAAE,IAAI;AAEjF,QAAQ,IAAI,0CAA0C,IAAI,EAAE;AAG5D,IAAM,aAAqC;AAAA,EACzC,SAAS,QAAQ,IAAI,eAAe,SAAS,QAAQ,IAAI,cAAc,EAAE,IAAI;AAAA,EAC7E,SAAS,QAAQ,IAAI,eAAe,SAAS,QAAQ,IAAI,cAAc,EAAE,IAAI;AAC/E;AAEA,QAAQ,IAAI,yBAAyB,UAAU;AAG/C,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS;AAC1B,UAAQ,IAAI,+BAA+B,IAAI,MAAM,IAAI,IAAI,GAAG,EAAE;AAClE,OAAK;AACP,CAAC;AAGD,OAAO,QAAQ,UAAU,EAAE,QAAQ,CAAC,CAAC,MAAM,IAAI,MAAM;AACnD,UAAQ,IAAI,mCAAmC,IAAI,iBAAiB,IAAI,EAAE;AAC1E,MAAI,IAAI,IAAI,IAAI,IAAI,sBAAsB;AAAA,IACxC,QAAQ,oBAAoB,IAAI;AAAA,IAChC,cAAc;AAAA,IACd,aAAa;AAAA,MACX,CAAC,KAAK,IAAI,EAAE,GAAG;AAAA;AAAA,IACjB;AAAA,IACA,SAAS,CAAC,KAAK,KAAK,QAAQ;AAC1B,cAAQ,MAAM,8BAA8B,IAAI,KAAK,GAAG;AACxD,UAAI,OAAO,GAAG,EAAE,KAAK,aAAa;AAAA,IACpC;AAAA,EACF,CAAC,CAAC;AACJ,CAAC;AAGD,IAAI,IAAI,KAAK,CAAC,KAAK,QAAQ;AACzB,MAAI,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAoBC,OAAO,KAAK,UAAU,EAAE;AAAA,IAAI,UAC5B,aAAa,IAAI,uBAAuB,KAAK,OAAO,CAAC,EAAE,YAAY,IAAI,KAAK,MAAM,CAAC,CAAC;AAAA,EACtF,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,GAIjB;AACH,CAAC;AAGD,IAAM,SAAS,KAAK,aAAa,GAAG;AAEpC,OAAO,OAAO,MAAM,WAAW,MAAM;AACnC,UAAQ,IAAI,6DAA6D,IAAI,EAAE;AAC/E,SAAO,QAAQ,UAAU,EAAE,QAAQ,CAAC,CAAC,MAAM,IAAI,MAAM;AACnD,YAAQ,IAAI,aAAa,KAAK,YAAY,CAAC,mCAAmC,IAAI,IAAI,IAAI,EAAE;AAAA,EAC9F,CAAC;AACH,CAAC;","names":[]}